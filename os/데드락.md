# Dead Lock (교착 상태)

두 개 이상의 작업이 서로 상대방의 작업이 끝나기를 기다리고 있어 결과적으로 연관되어있는 모든 작업들이 완료되지 못하고 무한히 대기하게 되는 상태

---

### 교착상태의 조건

1. 상호배제(Mutual exclusion) : 프로세스들이 필요로 하는 자원에 대해 배타적인 통제권을 요구한다.
  > 해당 Resource에 대해서 여러 개의 프로세스가 동시에 해당 리소스를 동시에 사용할 수 없으며, 하나의 프로세스만 해당 자원을 사용할 수 있다. 
  > 
  > 이미 하나의 프로세스에 할당된 Resource를 다른 프로세스가 요청하는 경우, Resource가 다 사용되고 반환되기까지 대기해야한다.

2. 점유대기(Hold and wait) : 프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다린다.
  > 이미 Resource를 가지고 있는 상태에서 다른 프로세스가 사용 중인 Resource를 점유하기 위해 대기하고 있는 프로세스가 존재해야한다.

3. 비선점(No preemption) : 프로세스가 어떤 자원의 사용을 끝낼 때까지 그 자원을 뺏을 수 없다.

4. 순환대기(Circular wait) : 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있다.

(순환 대기는 점유대기와 비선점과 연관이 있다. 각 교착상태의 조건이 서로 완전히 독립적이지 않다. 위 4가지 조건이 모두 만족되면 데드락이 발생한다.)

---

### 데드락을 해결하기 위한 방안 

#### 데드락 예방
1. 자원에 대한 상호배제 조건 방지 : 특정 리소스를 한번에 여러가지 프로세스가 사용할 수 있도록 한다. (데드락 문제를 해결되지만 동기화 문제가 생긴다.)
2. 점유대기 조건 방지(Hold and Wait) : 특정 프로세스가 요구하는 리소스를 한번에 모두 요청하고, 해당 리소스를 모두 사용할 수 있을 떄 프로세스를 진행시켜 대기하지 않도록 만드는 방식
3. 비선점 조건 방지(No preemption) : 이미 리소스를 할당받아 사용하고 있는 프로세스에서 다른 리소스를 요청하는 경우, 가지고 있던 Resource들 반환하고, 사용하고자 하는 Resource의 할당을 대기하도록 하는 방식 
4. 순환대기 방지 : 자원 유형에 따라 순서를 정해, 프로세스들이 정해진 순서대로만 리소스를 할당 받도록 한다. 

#### 데드락 회피 
데드락 회피 

Safe Sequence : 특정한 순서로 프로세스들에게 자원을 할당, 프로세스의 실행 및 종료등 작업을 할 때 데드락이 발생하지 않는 순서

Safe state : 시스템의 프로세스들이 요청하는 모든 자원을 데드락을 발생시키지 않으면서 차례로 모두에게 할당해 줄수 있는 상태 

회피 알고리즘 : 자원을 할당한 후에도 시스템이 항상 Safe State에 있도록 할당을 허용

은행원 알고리즘 : 다익스트라가 제안한 기법으로 자원을 할당하기전, 대기 중인 다른 프로세스들의 활동에 대한 교착 상태를 미리 조사한 후 안전 상태인 경우에만자원을 할당하는 기법 

(미리 최대 자원 요구량을 알아야하며, 할당할 수 있는 자원수가 일정해야하는 등 사용에 있어 제약조건이 많다.)

#### 데드락 탐지와 회복 

https://hoyeonkim795.github.io/posts/%ED%83%90%EC%A7%80%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/
https://velog.io/@lcy960729/%EA%B5%90%EC%B0%A9-%EC%83%81%ED%83%9C-%ED%83%90%EC%A7%80
