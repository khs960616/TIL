### Run-Time Constant Pool

자바 코드를 컴파일하여 만든 클래스, 또는 인터페이스의 바이트 코드에는 constant pool table이 존재한다. 

맨 처음 클래스가 로딩된 경우, 이 constant pool table에 존재하는 모든 참조는 symboli reference의 형태로 존재하게 된다.

심볼릭 레퍼런스를 단순하게 생각하면, 참고하는 클래스의 특정 메모리 주소를 참조 관계로 구성한 것이 아니라 참조하는 대상의 이름만을 가지고 있는 형태이다. 

symbolic reference는 constant pool에 존재하는 엔트리들의 각각의 tag값에 따라 다음의 정보를 나타낸다.


1. Class 또는 인터페이스에 대한 참조 : 클래스 또는 인터페이스에 대한 이름 정보를 반환한다. (Class.getName()의 메소드 형태로 반환된다고 생각하면 편하다.)
2. field인 경우 : 필드의 이름과 descriptor 또한, 해당 필드가 어떤 클래스에 속하는지에 대한 정보가 반환된다.
3. 클래스 메서드인 경우 : 메서드명, descriptor와 해당 메서드가 어떤 클래스에 속하는지에 대한 정보가 반환된다.
4. 인터페이스 메서드인 경우 : 메서드명, descriptor와 해당 메서드가 어떤 인터페이스에 속하는지에 대한 정보가 반환된다.

### 클래스의 생성과 로딩

자바에서는 클래스는 동적으로 로딩된다. 프로그램 실행 시에 해당 프로그램에 존재하는 모든 클래스를 로딩하는 방식이 아닌, 해당 클래스가 호출되어 사용되는 시점에

클래스를 로딩한다. (이 때 특정 클래스의 상수풀에, 다른 클래스에 대한 참조가 있다면, 연관된 클래스들도 같이 로딩된다.)

### 클래스 로더 
```
There are two kinds of class loaders: the bootstrap class loader supplied by the Java Virtual Machine, and user-defined class loaders. 
```
JVM에는 크게 두 가지 종류의 클래스 로더가 존재한다. (오라클 docs가 옛날 버전이라 extension classloader 관련된 내용은 없었다.)

(그냥 위임모델과, 실제 어떻게 동작하는지 정도 알아두면 될듯) 

1. bootstrap class loader : jvm 실행 시 최초로 실행되는 클래스 로더 

(jre/lib/rt.jar와 $JAVA_HOME/jre/lib에 있는 코어 라이블러리들을 포함한 JDK의 내부 클래스들을 로딩한다.)

2. user-defined class loaders : 사용자가 작성한 소스에서 시작된 클래스들을 생성할 수 있다. 

---

각 클래스 로더들은 특정 클래스를 직접 생성할 수 있으며, 또한 다른 클래스 로더에게 위임해서 생성할 수 있다.

런타임 때 클래스 또는 인터페이스는 단지 클래스(인터페이스)이름과 defining 클래스 로더의 쌍으로 결정된다.

---

클래스 C가 클래스 D로부터 trigger되어 생성되는 경우, JVM은 클래스를 생성할 때 다음 3가지 방법 중 한 가지를 채택해서 사용한다.

1. 생성하고자하는 클래스C가 nonarray class인 경우 
  > 만약 D가 bootstrap class loader에 의해 정의된 경우 class C 또한 bootstrap class loader에 의해 정의된다.
  > 만약 D가 user-defined class loaders에 의해 정의된 경우 class C 또한 user-defined class loaders에 의해 정의된다.

2. 생성하고자하는 클래스 C가 array class 인 경우
  > JVM에 의해 클래스 C가 생성되지만, 클래스 D를 정의한 클래스로더가 이 과정에서 사용된다.
---



https://stackoverflow.com/questions/39284030/java-classloader-difference-between-defining-loader-initiating-loader

https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-5.html#jvms-5.1

https://matdulgi.tistory.com/128

https://kingjakeu.github.io/java/2020/08/10/class-loader/
